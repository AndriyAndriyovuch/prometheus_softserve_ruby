<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type='text/javascript'>
    (function(){
        if(!sessionStorage.getItem('firstLoad')){
            sessionStorage['firstLoad'] = true;
            window.location.reload();
        }else{
            sessionStorage.removeItem('firstLoad');
        }})();
</script>

<div class="d-flex justify-content-center">
  <h1>Report by categories</h1>
</div>

<div class="d-flex justify-content-center">

  <div class="align-self-center" id="operations">
    <table class="table">
      <thead>
      <tr>
        <th scope="col">Outlay</th>
      </tr>
      <tbody class="table-group-divider">
      <tr>
        <th scope="col">Category</th>
        <th scope="col">Sum</th>
      </tr>
      </thead>
      <tbody class="table-group-divider">
      <% @categories_outlay.each do |category| %>
        <tr>
          <td><%= category[0] %></td>
          <td><%= category[1] %></td>
        </tr>
      <% end %>

      <tbody class="table-group-divider">
      <tr>
        <th scope="col">Total sum</th>
        <th scope="col"><%= @categories_outlay.map { |category| category[1] }.sum %></th>
      </tr>
      </table>
  </div>

  <div>
    <canvas id="myChart1" width="500"></canvas>
    <script>
        new Chart(document.getElementById('myChart1'), {
            type: 'polarArea',
            data: {
                labels: <%= raw @categories_outlay.keys  %>,
                datasets: [{
                    label: 'Outlay',
                    data: <%= @categories_outlay.values  %>,
                    backgroundColor: <%= raw @background_colors %>
                }]
            },
            options: {
                responsive: false
            }
        });
    </script>
  </div>

  <% if @operations_income.length > 0 %>
    <div class="align-self-center" id="operations">
      <table class="table">
        <thead>
        <tr>
          <th scope="col">Income</th>
        </tr>
        <tbody class="table-group-divider">
        <tr>
          <th scope="col">Category</th>
          <th scope="col">Sum</th>
        </tr>
        </thead>

        <tbody class="table-group-divider">

        <% @categories_income.each do |category| %>
          <tr>
            <td><%= category[0] %></td>
            <td><%= category[1] %></td>
          </tr>
        <% end %>

        <tbody class="table-group-divider">
        <tr>
          <th scope="col">Total sum</th>
          <th scope="col"><%= @categories_income.map { |category| category[1] }.sum %></th>
        </tr>

        </table>
    </div>

    <div>
      <canvas id="myChart2" width="500"></canvas>
      <script>
          new Chart(document.getElementById('myChart2'), {
              type: 'polarArea',
              data: {
                  labels: <%= raw @categories_income.keys  %>,
                  datasets: [{
                      label: 'Income',
                      data: <%= @categories_income.values  %>,
                      backgroundColor: <%= raw @background_colors %>
                  }]
              },
              options: {
                  responsive: false
              }
          });
      </script>
    </div>
  <% end %>

</div>